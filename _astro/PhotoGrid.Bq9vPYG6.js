import{A as C,d as w,y as S,T as E}from"./hooks.module.DgMOKmnS.js";import{l as k}from"./preact.module.IsPPbktY.js";var M=0;function m(r,a,u,h,o,s){a||(a={});var d,l,c=a;if("ref"in c)for(l in c={},a)l=="ref"?d=a[l]:c[l]=a[l];var f={type:r,props:c,key:u,ref:d,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--M,__i:-1,__u:0,__source:o,__self:s};if(typeof r=="function"&&(d=r.defaultProps))for(l in d)c[l]===void 0&&(c[l]=d[l]);return k.vnode&&k.vnode(f),f}function x({images:r,rowHeight:a,containerWidth:u,gapSize:h,index:o,onImageLoad:s,getImageIndex:d}){const l=C(null),[c,f]=w(!1),I=E(()=>{if(r.length===0)return"";let i=0;return r.forEach(t=>{i+=t.width/t.height}),r.map(t=>`${t.width/t.height/i}fr`).join(" ")},[r,u,h]);S(()=>{if(!l.current)return;const i=new IntersectionObserver(t=>{t.forEach(p=>{p.isIntersecting&&i.disconnect()})});return i.observe(l.current),()=>i.disconnect()},[]);const _=i=>{const t=i.target,p=parseInt(t.dataset.index||"0",10);s(o,p),t.previousElementSibling&&(t.previousElementSibling.style.display="none"),t.style.opacity="1"},v=i=>{const t=i.target,p=parseInt(t.dataset.index||"0",10);s(o,p),t.previousElementSibling&&(t.previousElementSibling.style.display="none"),t.style.opacity="1"};return m("div",{ref:l,className:`image-row ${c?"animate":""}`,style:{display:"grid",gridTemplateColumns:I,gap:`${h}rem`,height:`${a}px`,transition:"opacity 0.5s, filter 0.5s"},children:r.map((i,t)=>{const p=i.width/i.height,L=d(o,t),R=i.type==="video";return i.type==="gif"||i.src.toLowerCase().endsWith(".gif"),m("a",{href:i.src,style:{height:"100%",display:"block",overflow:"hidden",viewTransitionName:`image-${o}-${t}`,"--index":`${L}`,position:"relative"},children:[m(A,{aspectRatio:p}),R?m("video",{"data-index":t,onLoadedData:v,onMouseEnter:e=>{const n=e.target;e.isTrusted&&(n.classList.add("active"),n.play())},onMouseLeave:e=>{const n=e.target;e.isTrusted&&(n.classList.remove("active"),n.pause(),n.currentTime=0)},src:i.src,poster:i.poster,muted:!0,loop:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover",opacity:"0",transition:"opacity 0.3s ease-in-out",position:"absolute",top:0,left:0}}):m("img",{"data-index":t,onLoad:_,onMouseEnter:e=>{const n=e.target;e.isTrusted&&n.classList.add("active")},onMouseLeave:e=>{const n=e.target;e.isTrusted&&n.classList.remove("active")},src:i.src,alt:i.title||"",loading:"lazy",style:{width:"100%",height:"100%",objectFit:"cover",opacity:"0",transition:"opacity 0.3s ease-in-out",position:"absolute",top:0,left:0}})]},`${o}-${t}`)})})}function A({aspectRatio:r}){return m("div",{className:"skeleton-loading",style:{height:"100%",width:"100%",backgroundColor:"var(--accents-2, #f0f0f0)",position:"relative",overflow:"hidden"},children:m("div",{className:"skeleton-shimmer",style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.5), transparent)",animation:"skeleton-loading 1.5s infinite"}})})}function T(r){try{const u=new DOMParser().parseFromString(r,"text/xml");return Array.from(u.querySelectorAll("item")).flatMap(o=>{const s=o.querySelector("title")?.textContent||"",d=o.querySelector("description")?.textContent||"",c=new DOMParser().parseFromString(d,"text/html");return Array.from(c.querySelectorAll("img")).map(f=>({src:f.src,width:f.width,height:f.height,title:s,isLoaded:!1}))}).filter(o=>o.src&&o.width>0&&o.height>0)}catch(a){return console.error("Erreur lors du parsing RSS:",a),[]}}function D(r,a,u,h){if(r.length===0)return{rowImages:[],remainingImages:[]};let o=-h,s=0;for(s=0;s<r.length;s++){const d=r[s],c=d.width/d.height*u;if(o+=c+h,o>a){const f=o,I=o-(c+h);Math.abs(a-I)<Math.abs(a-f)&&s--;break}}return s=Math.max(1,s),{rowImages:r.slice(0,s+1),remainingImages:r.slice(s+1)}}function O({rss:r,images:a,rowHeight:u=200,gap:h="0.5rem",maxRows:o=1/0}){const s=C(null),[d,l]=w([]),[c,f]=w(0),[I,_]=w([]),v=parseFloat(h),[i,t]=w([]);S(()=>{if(a&&a.length>0){l(a);return}if(r){const e=T(r);l(e);return}l([])},[r,a]),S(()=>{if(!s.current)return;const e=()=>{s.current&&f(s.current.getBoundingClientRect().width)};e();const n=new ResizeObserver(e);return n.observe(s.current),()=>n.disconnect()},[]);const p=E(()=>{if(c===0||d.length===0)return[];const e=[];let n=[...d];const y=[];for(;n.length>0&&e.length<o;){const{rowImages:b,remainingImages:$}=D(n,c,u,v);if(e.push(b),y.push(...b),n=$,b.length===0)break}t(y);const g=e.map(b=>Array(b.length).fill(!1));return _(g),e},[d,c,u,v,o]),L=(e,n)=>{_(y=>{const g=[...y];return g[e]&&(g[e]=[...g[e]],g[e][n]=!0),g})},R=(e,n)=>{let y=0;for(let g=0;g<e;g++)y+=p[g].length;return y+n};return S(()=>{const e=document.createElement("style");return e.textContent=`
      @keyframes skeleton-loading {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
      }
    `,document.head.appendChild(e),()=>{document.head.removeChild(e)}},[]),m("div",{ref:s,className:"photo-grid",style:{display:"flex",flexDirection:"column",gap:h},children:p.map((e,n)=>m(x,{images:e,rowHeight:u,containerWidth:c,gapSize:v,index:n,onImageLoad:L,getImageIndex:R},`row-${n}`))})}export{O as PhotoGrid};
