import{A as k,d as w,y as L,T as E}from"./hooks.module.BKHCj0z0.js";import{u as g}from"./jsxRuntime.module.fOORsCCE.js";import"./preact.module.B5PsXcXZ.js";function $({images:i,rowHeight:a,containerWidth:p,gapSize:u,index:s,onImageLoad:o,getImageIndex:h}){const m=k(null),[l,f]=w(!1),I=E(()=>{if(i.length===0)return"";let r=0;return i.forEach(e=>{r+=e.width/e.height}),i.map(e=>`${e.width/e.height/r}fr`).join(" ")},[i,p,u]);L(()=>{if(!m.current)return;const r=new IntersectionObserver(e=>{e.forEach(c=>{c.isIntersecting&&r.disconnect()})});return r.observe(m.current),()=>r.disconnect()},[]);const S=r=>{const e=r.target,c=parseInt(e.dataset.index||"0",10);o(s,c),e.previousElementSibling&&(e.previousElementSibling.style.display="none"),e.style.opacity="1"},v=r=>{const e=r.target,c=parseInt(e.dataset.index||"0",10);o(s,c),e.previousElementSibling&&(e.previousElementSibling.style.display="none"),e.style.opacity="1"};return g("div",{ref:m,className:`image-row ${l?"animate":""}`,style:{display:"grid",gridTemplateColumns:I,gap:`${u}rem`,height:`${a}px`,transition:"opacity 0.5s, filter 0.5s"},children:i.map((r,e)=>{const c=r.width/r.height,R=h(s,e),C=r.type==="video";return r.type==="gif"||r.src.toLowerCase().endsWith(".gif"),g("a",{href:r.src,style:{height:"100%",display:"block",overflow:"hidden",viewTransitionName:`image-${s}-${e}`,"--index":`${R}`,position:"relative"},children:[g(x,{aspectRatio:c}),C?g("video",{"data-index":e,onLoadedData:v,onMouseEnter:t=>{const n=t.target;t.isTrusted&&(n.classList.add("active"),n.play())},onMouseLeave:t=>{const n=t.target;t.isTrusted&&(n.classList.remove("active"),n.pause(),n.currentTime=0)},src:r.src,poster:r.poster,muted:!0,loop:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover",opacity:"0",transition:"opacity 0.3s ease-in-out",position:"absolute",top:0,left:0}}):g("img",{"data-index":e,onLoad:S,onMouseEnter:t=>{const n=t.target;t.isTrusted&&n.classList.add("active")},onMouseLeave:t=>{const n=t.target;t.isTrusted&&n.classList.remove("active")},src:r.src,alt:r.title||"",loading:"lazy",style:{width:"100%",height:"100%",objectFit:"cover",opacity:"0",transition:"opacity 0.3s ease-in-out",position:"absolute",top:0,left:0}})]},`${s}-${e}`)})})}function x({aspectRatio:i}){return g("div",{className:"skeleton-loading",style:{height:"100%",width:"100%",backgroundColor:"var(--accents-2, #f0f0f0)",position:"relative",overflow:"hidden"},children:g("div",{className:"skeleton-shimmer",style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.5), transparent)",animation:"skeleton-loading 1.5s infinite"}})})}function A(i){try{const p=new DOMParser().parseFromString(i,"text/xml");return Array.from(p.querySelectorAll("item")).flatMap(s=>{const o=s.querySelector("title")?.textContent||"",h=s.querySelector("description")?.textContent||"",l=new DOMParser().parseFromString(h,"text/html");return Array.from(l.querySelectorAll("img")).map(f=>({src:f.src,width:f.width,height:f.height,title:o,isLoaded:!1}))}).filter(s=>s.src&&s.width>0&&s.height>0)}catch(a){return console.error("Erreur lors du parsing RSS:",a),[]}}function T(i,a,p,u){if(i.length===0)return{rowImages:[],remainingImages:[]};let s=-u,o=0;for(o=0;o<i.length;o++){const h=i[o],l=h.width/h.height*p;if(s+=l+u,s>a){const f=s,I=s-(l+u);Math.abs(a-I)<Math.abs(a-f)&&o--;break}}return o=Math.max(1,o),{rowImages:i.slice(0,o+1),remainingImages:i.slice(o+1)}}function O({rss:i,images:a,rowHeight:p=200,gap:u="0.5rem",maxRows:s=1/0}){const o=k(null),[h,m]=w([]),[l,f]=w(0),[I,S]=w([]),v=parseFloat(u),[r,e]=w([]);L(()=>{if(a&&a.length>0){m(a);return}if(i){const t=A(i);m(t);return}m([])},[i,a]),L(()=>{if(!o.current)return;const t=()=>{o.current&&f(o.current.getBoundingClientRect().width)};t();const n=new ResizeObserver(t);return n.observe(o.current),()=>n.disconnect()},[]);const c=E(()=>{if(l===0||h.length===0)return[];const t=[];let n=[...h];const y=[];for(;n.length>0&&t.length<s;){const{rowImages:b,remainingImages:M}=T(n,l,p,v);if(t.push(b),y.push(...b),n=M,b.length===0)break}e(y);const d=t.map(b=>Array(b.length).fill(!1));return S(d),t},[h,l,p,v,s]),R=(t,n)=>{S(y=>{const d=[...y];return d[t]&&(d[t]=[...d[t]],d[t][n]=!0),d})},C=(t,n)=>{let y=0;for(let d=0;d<t;d++)y+=c[d].length;return y+n};return L(()=>{const t=document.createElement("style");return t.textContent=`
      @keyframes skeleton-loading {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
      }
    `,document.head.appendChild(t),()=>{document.head.removeChild(t)}},[]),g("div",{ref:o,className:"photo-grid",style:{display:"flex",flexDirection:"column",gap:u},children:c.map((t,n)=>g($,{images:t,rowHeight:p,containerWidth:l,gapSize:v,index:n,onImageLoad:R,getImageIndex:C},`row-${n}`))})}export{O as PhotoGrid};
